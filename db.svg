<svg width="600" height="900" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1150 1500">

  <!-- Marker Definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <!-- Style -->
  <style>
    .table-box { fill: none; stroke: #666; stroke-width: 1.5; }
    .table-title { font-weight: bold; font-family: 'Kalam', cursive; fill: #191970; text-anchor: middle; font-size: 24px; }
    .table-text { font-family: 'Kalam', cursive; fill: #191970; font-size: 20px; }
    .connection { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    .subcollection-connection { stroke: #666; stroke-width: 2; fill: none; stroke-dasharray: 6, 4; marker-end: url(#arrowhead); }
  </style>


  <!-- Table: Firebase Auth -->
  <g id="auth" transform="translate(30, 100)">
    <rect width="250" height="140" class="table-box"/>
    <text x="125" y="35" class="table-title">Firebase Auth</text>
    <line x1="10" y1="50" x2="240" y2="50" stroke="#666"/>
    <text x="20" y="70" class="table-text">
      <tspan x="20" dy="1.2em">uid (PK)</tspan>
      <tspan x="20" dy="1.2em">email</tspan>
    </text>
  </g>

  <!-- Table: users -->
  <g id="users" transform="translate(380, 100)">
    <rect width="320" height="210" class="table-box"/>
    <text x="160" y="35" class="table-title">users</text>
    <line x1="10" y1="50" x2="310" y2="50" stroke="#666"/>
    <text x="20" y="70" class="table-text">
      <tspan x="20" dy="1.2em">name</tspan>
      <tspan x="20" dy="1.2em">role</tspan>
      <tspan x="20" dy="1.2em">learning_goal</tspan>
      <tspan x="20" dy="1.2em">availability</tspan>
      <tspan x="20" dy="1.2em">stream</tspan>
    </text>
  </g>

  <!-- Table: subjects -->
  <g id="subjects" transform="translate(780, 100)">
    <rect width="280" height="160" class="table-box"/>
    <text x="140" y="35" class="table-title">subjects</text>
    <line x1="10" y1="50" x2="270" y2="50" stroke="#666"/>
    <text x="20" y="70" class="table-text">
      <tspan x="20" dy="1.2em">name</tspan>
      <tspan x="20" dy="1.2em">description</tspan>
      <tspan x="20" dy="1.2em">assigned_kp_id (FK)</tspan>
    </text>
  </g>

  <!-- Table: topics -->
  <g id="topics" transform="translate(780, 380)">
    <rect width="280" height="185" class="table-box"/>
    <text x="140" y="35" class="table-title">topics</text>
    <line x1="10" y1="50" x2="270" y2="50" stroke="#666"/>
    <text x="20" y="70" class="table-text">
      <tspan x="20" dy="1.2em">title</tspan>
      <tspan x="20" dy="1.2em">order</tspan>
      <tspan x="20" dy="1.2em">status</tspan>
      <tspan x="20" dy="1.2em">next_topic_paths</tspan>
    </text>
  </g>

  <!-- Table: content_chunks -->
  <g id="content_chunks" transform="translate(780, 680)">
    <rect width="300" height="210" class="table-box"/>
    <text x="150" y="35" class="table-title">content_chunks</text>
    <line x1="10" y1="50" x2="290" y2="50" stroke="#666"/>
    <text x="20" y="70" class="table-text">
      <tspan x="20" dy="1.2em">title</tspan>
      <tspan x="20" dy="1.2em">content</tspan>
      <tspan x="20" dy="1.2em">order</tspan>
      <tspan x="20" dy="1.2em">topic_id (FK)</tspan>
      <tspan x="20" dy="1.2em">source_document_name</tspan>
    </text>
  </g>

  <!-- Table: student_progress -->
  <g id="student_progress" transform="translate(380, 500)">
    <rect width="320" height="260" class="table-box"/>
    <text x="160" y="35" class="table-title">student_progress</text>
    <line x1="10" y1="50" x2="310" y2="50" stroke="#666"/>
    <text x="20" y="70" class="table-text">
      <tspan x="20" dy="1.2em">student_id (FK)</tspan>
      <tspan x="20" dy="1.2em">subject_id (FK)</tspan>
      <tspan x="20" dy="1.2em">topic_path (FK)</tspan>
      <tspan x="20" dy="1.2em">status</tspan>
      <tspan x="20" dy="1.2em">quiz_score_history</tspan>
      <tspan x="20" dy="1.2em">last_studied_date</tspan>
      <tspan x="20" dy="1.2em">study_sessions_completed</tspan>
    </text>
  </g>
  
  <!-- Table: student_schedules -->
  <g id="student_schedules" transform="translate(30, 500)">
    <rect width="280" height="210" class="table-box"/>
    <text x="140" y="35" class="table-title">student_schedules</text>
    <line x1="10" y1="50" x2="270" y2="50" stroke="#666"/>
    <text x="20" y="70" class="table-text">
      <tspan x="20" dy="1.2em">student_id (FK)</tspan>
      <tspan x="20" dy="1.2em">subject_id (FK)</tspan>
      <tspan x="20" dy="1.2em">schedule_items</tspan>
      <tspan x="20" dy="1.2em">last_updated_date</tspan>
      <tspan x="20" dy="1.2em">target_completion_date</tspan>
    </text>
  </g>

  <!-- Connections -->
  <g class="connections">
    <!-- Auth -> users -->
    <path d="M 280 170 H 380" class="connection"/>
    
    <!-- users -> subjects -->
    <path d="M 700 180 H 780" class="connection"/>

    <!-- subjects -> topics (subcollection) -->
    <path d="M 920 260 V 380" class="subcollection-connection"/>

    <!-- topics -> content_chunks -->
    <path d="M 920 565 V 680" class="connection"/>

    <!-- users -> student_progress -->
    <path d="M 540 310 V 500" class="connection"/>

    <!-- users -> student_schedules -->
    <path d="M 380 205 C 340 350, 340 450, 310 550" class="connection"/>
    
    <!-- subjects -> student_progress -->
    <path d="M 780 230 C 740 330, 740 430, 700 550" class="connection"/>

    <!-- subjects -> student_schedules -->
    <path d="M 920 260 V 300 C 600 320, 350 350, 170 500" class="connection"/>

    <!-- topics -> student_progress -->
    <path d="M 780 500 H 700" class="connection"/>
  </g>
</svg>